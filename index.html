<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.T.D.DENTALLAB - Partner Clinics</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- SweetAlert2 for notifications -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Google Fonts: Kanit -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            overflow-x: hidden; /* Prevent horizontal scroll from emojis */
        }
        /* Custom styles for better aesthetics */
        .btn {
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        }
        .btn:hover {
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .btn-gradient {
            background-image: linear-gradient(to right, #a8c0ff 0%, #d9a7c7 51%, #f3a683 100%);
            transition: 0.5s;
            background-size: 200% auto;
            color: white;
        }
        .btn-gradient:hover {
            background-position: right center;
        }
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        /* Loading Spinner */
        .loader {
            border: 8px solid #f3f3f3;
            border-radius: 50%;
            border-top: 8px solid #a8c0ff;
            width: 60px;
            height: 60px;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- ADDED: Emoji Background Animation --- */
        #emoji-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }
        .emoji {
            position: absolute;
            bottom: -50px; /* Start from below the screen */
            font-size: 2rem;
            opacity: 0.2;
            animation: floatUp 15s linear infinite;
        }
        @keyframes floatUp {
            0% {
                transform: translateY(0);
                opacity: 0.2;
            }
            100% {
                transform: translateY(-100vh); /* Move up to the top */
                opacity: 0.1;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Main container -->
    <div class="container mx-auto p-4 max-w-7xl">

        <!-- Cover Page -->
        <div id="page-cover">
            <div class="min-h-screen relative flex flex-col text-center p-6 rounded-2xl bg-gradient-to-br from-blue-100 via-purple-100 to-pink-100 overflow-hidden">
                
                <!-- ADDED: Emoji background container -->
                <div id="emoji-background"></div>

                <!-- Main Content Wrapper, flex-grow and z-10 to be on top of emojis -->
                <div class="relative z-10 flex-grow flex flex-col items-center justify-center">
                    <h1 class="text-4xl md:text-6xl font-bold text-gray-700 mb-2">S.T.D. DENTAL LAB</h1>
                    <p class="text-xl md:text-2xl text-gray-600 mb-8">ü¶∑‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤‚ú®</p>
                    <div class="space-y-4 md:space-y-0 md:space-x-4 flex flex-col md:flex-row items-center">
                        <button onclick="showPage('page-dashboard')" class="btn btn-gradient font-bold py-3 px-6 rounded-full shadow-lg text-lg w-full md:w-auto mb-4 md:mb-0">
                            ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏° üè•
                        </button>
                        <button onclick="showPage('page-register')" class="btn btn-gradient font-bold py-3 px-6 rounded-full shadow-lg text-lg w-full md:w-auto mb-4 md:mb-0">
                            ‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏™‡∏ô‡πÉ‡∏à‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤ ‚úçÔ∏è
                        </button>
                        <button onclick="showPage('page-catalog')" class="btn btn-gradient font-bold py-3 px-6 rounded-full shadow-lg text-lg w-full md:w-auto">
                            Catalog ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ üì¶
                        </button>
                    </div>
                </div>

                <!-- About Us Section (Footer), z-10 to be on top -->
                <div class="relative z-10 w-full">
                    <div class="max-w-3xl mx-auto bg-white bg-opacity-60 backdrop-blur-sm p-4 rounded-xl shadow-md">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</h3>
                        <p class="text-sm text-gray-700">
                            ‡∏´‡πâ‡∏≤‡∏á‡∏´‡∏∏‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏≥‡∏Å‡∏±‡∏î ‡πÄ‡∏≠‡∏™.‡∏ó‡∏µ.‡∏î‡∏µ.‡πÄ‡∏î‡πá‡∏ô‡∏ï‡∏≠‡∏• ‡πÅ‡∏•‡∏õ ‡∏à.‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏•‡∏õ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏¥‡∏ï‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ó‡∏±‡πà‡∏ß‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® ‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏∏‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô
                        </p>
                        <p class="text-sm text-gray-600 mt-2 font-semibold">
                            ‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ‡∏ï.‡∏™‡∏±‡∏ô‡∏õ‡∏π‡πÄ‡∏•‡∏¢ ‡∏≠.‡∏î‡∏≠‡∏¢‡∏™‡∏∞‡πÄ‡∏Å‡πá‡∏î ‡∏à.‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà (‡πÉ‡∏Å‡∏•‡πâ‡πÅ‡∏¢‡∏Å‡πÅ‡∏°‡πà‡∏Å‡∏ß‡∏á)
                        </p>
                    </div>
                </div>

            </div>
        </div>

        <!-- Dashboard Page -->
        <div id="page-dashboard" class="hidden">
            <!-- UPDATED: Button styling -->
            <button onclick="showPage('page-cover')" class="btn mb-4 bg-gray-200 text-gray-700 py-2 px-4 rounded-full hover:bg-gray-300">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
            <h2 class="text-3xl font-bold mb-4 text-center text-gray-700">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠</h2>
            
            <div class="my-6 flex flex-col md:flex-row justify-center items-center gap-4">
                <div class="flex items-center">
                    <label for="province-filter" class="mr-2 font-semibold text-gray-700">‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î:</label>
                    <select id="province-filter" class="p-2 border border-gray-300 rounded-lg shadow-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <!-- Options populated by JS -->
                    </select>
                </div>
                <!-- UPDATED: Button styling -->
                <button id="update-clinics-btn" class="btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-full shadow-md">
                    üîÑ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
            
            <div id="loader-dashboard" class="hidden justify-center items-center my-8"><div class="loader"></div></div>
            <div class="overflow-x-auto bg-white rounded-lg shadow">
                <table class="min-w-full leading-normal">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th>
                            <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å / ‡πÇ‡∏•‡πÇ‡∏Å‡πâ</th>
                            <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Cover</th>
                            <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</th>
                            <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</th>
                        </tr>
                    </thead>
                    <tbody id="clinic-table-body">
                        <!-- Data will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Registration Page -->
        <div id="page-register" class="hidden">
            <!-- UPDATED: Button styling -->
            <button onclick="showPage('page-cover')" class="btn mb-4 bg-gray-200 text-gray-700 py-2 px-4 rounded-full hover:bg-gray-300">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
            <div class="max-w-2xl mx-auto bg-white p-8 rounded-2xl shadow-lg">
                <h2 class="text-3xl font-bold mb-6 text-center text-gray-700">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°</h2>
                <form id="clinic-form">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="province">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
                            <select id="province" name="province" class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required></select>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="clinicName">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°</label>
                            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="clinicName" name="clinicName" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏±‡∏Å‡∏ü‡∏±‡∏ô" required>
                        </div>
                         <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="clinicPage">‡∏•‡∏¥‡πâ‡∏á‡πÄ‡∏û‡∏à‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å (URL)</label>
                            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="clinicPage" name="clinicPage" type="url" placeholder="https://www.facebook.com/yourclinic">
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="dentistName">‡∏ó‡∏û. ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å</label>
                            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="dentistName" name="dentistName" type="text" placeholder="‡∏ó‡∏û. ‡πÉ‡∏à‡∏î‡∏µ ‡∏°‡∏µ‡πÄ‡∏°‡∏ï‡∏ï‡∏≤">
                        </div>
                         <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="logoUrl">‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ LOGO (URL)</label>
                            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="logoUrl" name="logoUrl" type="url" placeholder="‡∏ß‡∏≤‡∏á URL ‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="coverUrl">‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ Cover (URL)</label>
                            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="coverUrl" name="coverUrl" type="url" placeholder="‡∏ß‡∏≤‡∏á URL ‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ Cover ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="contactNumber">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö</label>
                            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="contactNumber" name="contactNumber" type="tel" placeholder="081-234-5678" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="additional">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                            <select id="additional" name="additional" class="shadow border rounded w-full py-2 px-3 text-gray-700 focus:outline-none focus:shadow-outline">
                                <option value="‡∏Ç‡∏≠‡∏ä‡∏∏‡∏î catalog retaianer ‡πÅ‡∏•‡∏∞‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏õ">‡∏Ç‡∏≠‡∏ä‡∏∏‡∏î catalog ‡πÅ‡∏•‡∏∞‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏õ</option>
                                <option value="‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á(‡∏£‡∏≤‡∏Ñ‡∏≤50%‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏õ)">‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (‡∏£‡∏≤‡∏Ñ‡∏≤ 50%)</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-8 text-center">
                        <!-- UPDATED: Button styling -->
                        <button class="btn bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-8 rounded-full shadow-lg" type="submit">
                            ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Catalog Page -->
        <div id="page-catalog" class="hidden">
            <!-- UPDATED: Button styling -->
            <button onclick="showPage('page-cover')" class="btn mb-4 bg-gray-200 text-gray-700 py-2 px-4 rounded-full hover:bg-gray-300">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
            <h2 class="text-3xl font-bold mb-6 text-center text-gray-700">Catalog ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
             <div class="text-center mb-6">
                <!-- UPDATED: Button styling -->
                <button id="update-catalog-btn" class="btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-full shadow-md">
                    üîÑ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
            <div id="loader-catalog" class="hidden justify-center items-center my-8"><div class="loader"></div></div>
            <div id="catalog-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6">
                <!-- Catalog items will be inserted here -->
            </div>
        </div>

    </div>

    <script>
        // --- CONFIGURATION ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwhJWSdRTDWW9drAPulgPrQOZk2W8nMkuS9mZHowUlZCEc6aaE43-Exkx7YdOHOyTK9/exec";

        // --- PAGE NAVIGATION ---
        const pages = ['page-cover', 'page-dashboard', 'page-register', 'page-catalog'];
        function showPage(pageId) {
            pages.forEach(id => {
                const page = document.getElementById(id);
                if (id === pageId) {
                    page.classList.remove('hidden');
                } else {
                    page.classList.add('hidden');
                }
            });
            window.scrollTo(0, 0);

            // Auto-load data if not already loaded
            if (pageId === 'page-dashboard' && !localStorage.getItem('clinicData')) {
                fetchClinicData();
            }
            if (pageId === 'page-catalog' && !localStorage.getItem('catalogData')) {
                fetchCatalogData();
            }
        }

        // --- DATA FETCHING (JSONP) ---
        function fetchDataJsonp(action, callbackName) {
            const oldScript = document.getElementById('jsonp-script');
            if (oldScript) {
                oldScript.remove();
            }
            
            const script = document.createElement('script');
            script.id = 'jsonp-script';
            script.src = `${SCRIPT_URL}?action=${action}&callback=${callbackName}`;
            document.head.appendChild(script);
            
            script.onerror = () => {
                 Swal.fire('Error!', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
                 hideAllLoaders();
                 script.remove();
            }
        }
        
        function hideAllLoaders() {
            document.getElementById('loader-dashboard').classList.add('hidden');
            document.getElementById('loader-catalog').classList.add('hidden');
        }

        // --- GLOBAL DATA STORE ---
        let allClinicsData = []; // To hold the full list of clinics for filtering

        // --- CLINIC DASHBOARD ---
        const clinicTableBody = document.getElementById('clinic-table-body');
        const updateClinicsBtn = document.getElementById('update-clinics-btn');
        const provinceFilterSelect = document.getElementById('province-filter'); // Get the filter element

        function fetchClinicData() {
            document.getElementById('loader-dashboard').style.display = 'flex';
            clinicTableBody.innerHTML = ''; 
            localStorage.removeItem('clinicData');
            fetchDataJsonp('getClinics', 'handleClinicData'); // Call the handler function
        }

        // This function renders the table based on the filter
        function renderFilteredClinics() {
            const filterValue = provinceFilterSelect.value;
            const clinicsToRender = filterValue === 'all'
                ? allClinicsData
                : allClinicsData.filter(clinic => clinic.province === filterValue);

            clinicTableBody.innerHTML = ''; // Clear table before rendering

            if (clinicsToRender && clinicsToRender.length > 0) {
                clinicsToRender.forEach(clinic => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">${clinic.province}</td>
                        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 w-12 h-12">
                                     <a href="${clinic.logo || '#'}" target="_blank" rel="noopener noreferrer">
                                        <img class="w-full h-full rounded-full object-cover cursor-pointer hover:opacity-80 transition-opacity" src="${clinic.logo || 'https://placehold.co/100x100/E2E8F0/A0AEC0?text=Logo'}" alt="Clinic Logo" onerror="this.onerror=null;this.src='https://placehold.co/100x100/E2E8F0/A0AEC0?text=Logo';">
                                     </a>
                                </div>
                                <div class="ml-3">
                                    <p class="text-gray-900 whitespace-no-wrap font-semibold">${clinic.name}</p>
                                    <a href="${clinic.pageLink || '#'}" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:text-blue-700 whitespace-no-wrap text-xs">‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°‡πÄ‡∏û‡∏à</a>
                                </div>
                            </div>
                        </td>
                        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                            <a href="${clinic.cover || '#'}" target="_blank" rel="noopener noreferrer">
                                <img class="w-24 h-16 rounded-md object-cover cursor-pointer hover:opacity-80 transition-opacity" src="${clinic.cover || 'https://placehold.co/400x200/E2E8F0/A0AEC0?text=Cover'}" alt="Cover Photo" onerror="this.onerror=null;this.src='https://placehold.co/400x200/E2E8F0/A0AEC0?text=Cover';">
                            </a>
                        </td>
                        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                            <span class="text-yellow-500 text-lg">${clinic.review || 'N/A'}</span>
                        </td>
                        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                            <p class="text-gray-900 whitespace-no-wrap">${clinic.phone}</p>
                        </td>
                    `;
                    clinicTableBody.appendChild(row);
                });
            } else {
                 clinicTableBody.innerHTML = '<tr><td colspan="5" class="text-center p-4">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</td></tr>';
            }
        }

        // This is the JSONP callback. It prepares data and populates the filter.
        function handleClinicData(data) {
            localStorage.setItem('clinicData', JSON.stringify(data));
            allClinicsData = data || []; // Store data globally
            
            // Populate the filter dropdown with unique provinces from the data
            const currentFilterValue = provinceFilterSelect.value;
            const uniqueProvinces = [...new Set(allClinicsData.map(c => c.province).filter(p => p))].sort();
            provinceFilterSelect.innerHTML = '<option value="all">-- ‡∏ó‡∏∏‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î --</option>'; // Reset
            uniqueProvinces.forEach(p => {
                const option = document.createElement('option');
                option.value = p;
                option.textContent = p;
                provinceFilterSelect.appendChild(option);
            });
             // Restore previous filter selection if it still exists
            if (uniqueProvinces.includes(currentFilterValue)) {
                provinceFilterSelect.value = currentFilterValue;
            }

            renderFilteredClinics(); // Render the table with the new data
            document.getElementById('loader-dashboard').style.display = 'none';
        }

        // --- CATALOG ---
        const catalogGrid = document.getElementById('catalog-grid');
        const updateCatalogBtn = document.getElementById('update-catalog-btn');

        function fetchCatalogData() {
            document.getElementById('loader-catalog').style.display = 'flex';
            catalogGrid.innerHTML = '';
            localStorage.removeItem('catalogData');
            fetchDataJsonp('getCatalog', 'renderCatalog');
        }

        function renderCatalog(data) {
            localStorage.setItem('catalogData', JSON.stringify(data));
            catalogGrid.innerHTML = '';
             if (data && data.length > 0) {
                 data.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'card text-center';
                    card.innerHTML = `
                        <a href="${item.imageUrl || '#'}" target="_blank" rel="noopener noreferrer">
                           <img src="${item.imageUrl || 'https://placehold.co/300x300/E2E8F0/A0AEC0?text=Product'}" alt="${item.name}" class="w-full h-48 object-cover cursor-pointer hover:opacity-80 transition-opacity" onerror="this.onerror=null;this.src='https://placehold.co/300x300/E2E8F0/A0AEC0?text=Product';">
                        </a>
                        <div class="p-4">
                            <a href="${item.imageUrl || '#'}" target="_blank" rel="noopener noreferrer">
                               <h3 class="font-semibold text-gray-800 hover:text-blue-600 transition-colors">${item.name}</h3>
                            </a>
                        </div>
                    `;
                    catalogGrid.appendChild(card);
                 });
             } else {
                catalogGrid.innerHTML = '<p class="col-span-full text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>';
             }
            document.getElementById('loader-catalog').style.display = 'none';
        }
        
        // --- REGISTRATION FORM ---
        const clinicForm = document.getElementById('clinic-form');
        clinicForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà', allowOutsideClick: false, didOpen: () => { Swal.showLoading(); }});
            const formData = new FormData(clinicForm);
            const data = Object.fromEntries(formData.entries());
            try {
                await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: {'Content-Type': 'application/x-www-form-urlencoded',}, body: new URLSearchParams(data).toString()});
                Swal.fire({ icon: 'success', title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß'});
                clinicForm.reset();
                populateProvinces();
            } catch (error) {
                console.error('Error:', error);
                Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ'});
            }
        });

        // --- INITIALIZATION ---
        const provinces = ["‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà", "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£", "‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", "‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå", "‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£", "‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", "‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤", "‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", "‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó", "‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥", "‡∏ä‡∏∏‡∏°‡∏û‡∏£", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏ï‡∏£‡∏±‡∏á", "‡∏ï‡∏£‡∏≤‡∏î", "‡∏ï‡∏≤‡∏Å", "‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å", "‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°", "‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°", "‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤", "‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä", "‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå", "‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™", "‡∏ô‡πà‡∏≤‡∏ô", "‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨", "‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå", "‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå", "‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", "‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ", "‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤", "‡∏û‡∏∞‡πÄ‡∏¢‡∏≤", "‡∏û‡∏±‡∏á‡∏á‡∏≤", "‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á", "‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£", "‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å", "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ", "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå", "‡πÅ‡∏û‡∏£‡πà", "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", "‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°", "‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£", "‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô", "‡∏¢‡πÇ‡∏™‡∏ò‡∏£", "‡∏¢‡∏∞‡∏•‡∏≤", "‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î", "‡∏£‡∏∞‡∏ô‡∏≠‡∏á", "‡∏£‡∏∞‡∏¢‡∏≠‡∏á", "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ", "‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ", "‡∏•‡∏≥‡∏õ‡∏≤‡∏á", "‡∏•‡∏≥‡∏û‡∏π‡∏ô", "‡πÄ‡∏•‡∏¢", "‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©", "‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£", "‡∏™‡∏á‡∏Ç‡∏•‡∏≤", "‡∏™‡∏ï‡∏π‡∏•", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£", "‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß", "‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢", "‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå", "‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢", "‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π", "‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á", "‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç", "‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå", "‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ"];

        function populateProvinces() {
            const provinceSelect = document.getElementById('province');
            provinceSelect.innerHTML = '<option value="" disabled selected>--- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ---</option>';
            provinces.forEach(p => {
                const option = document.createElement('option');
                option.value = p;
                option.textContent = p;
                provinceSelect.appendChild(option);
            });
        }
        
        // ADDED: Function to create animated emoji background
        function createEmojiBackground() {
            const container = document.getElementById('emoji-background');
            const emojiCount = 30; // Number of emojis
            for (let i = 0; i < emojiCount; i++) {
                const emoji = document.createElement('span');
                emoji.className = 'emoji';
                emoji.textContent = 'ü¶∑';
                emoji.style.left = `${Math.random() * 100}vw`; // Random horizontal position
                emoji.style.animationDuration = `${Math.random() * 10 + 10}s`; // Random duration between 10-20s
                emoji.style.animationDelay = `-${Math.random() * 15}s`; // Start at different times
                emoji.style.fontSize = `${Math.random() * 2 + 1}rem`; // Random size
                container.appendChild(emoji);
            }
        }

        function loadCachedData() {
            const clinicData = localStorage.getItem('clinicData');
            if(clinicData){
                handleClinicData(JSON.parse(clinicData));
            }
            const catalogData = localStorage.getItem('catalogData');
            if(catalogData) {
                renderCatalog(JSON.parse(catalogData));
            }
        }

        window.onload = function() {
            populateProvinces();
            loadCachedData();
            createEmojiBackground(); // Create the background on load
            updateClinicsBtn.addEventListener('click', fetchClinicData);
            updateCatalogBtn.addEventListener('click', fetchCatalogData);
            provinceFilterSelect.addEventListener('change', renderFilteredClinics); // Add event listener for the filter
        };
    </script>
</body>
</html>
